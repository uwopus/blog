<!doctype html><html class="not-ready lg:text-base" style=--bg:#faf8f1 lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<title>Raspberry Pi Zero Bringup - Opus Build Blog: Autonomous Wall Plotting Robot</title><meta name=theme-color>
<meta name=description content="The Raspberry Pi Zero 2 is the main computer for the robot, and performs the path planning and high-level control for Opus. Although there is a previous post that outlines how to install CAN on a Pi Zero, it was determined that the CAN implementation would take much more time for insignificant returns. This post outlines how the initial setup was done on the Zero so that it is able to build programs for the Pico, program it, and development can start on the communication.">
<meta name=author content="Opus Build Blog: Autonomous Wall Plotting Robot">
<link rel="preload stylesheet" as=style href=https://uwopus.github.io/blog/main.min.css>
<link rel=preload as=image href=https://uwopus.github.io/blog/theme.png>
<script defer src=https://uwopus.github.io/blog/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://uwopus.github.io/blog/favicon.ico>
<link rel=apple-touch-icon href=https://uwopus.github.io/blog/apple-touch-icon.png>
<meta name=generator content="Hugo 0.93.3">
<meta itemprop=name content="Raspberry Pi Zero Bringup">
<meta itemprop=description content="The Raspberry Pi Zero 2 is the main computer for the robot, and performs the path planning and high-level control for Opus. Although there is a previous post that outlines how to install CAN on a Pi Zero, it was determined that the CAN implementation would take much more time for insignificant returns. This post outlines how the initial setup was done on the Zero so that it is able to build programs for the Pico, program it, and development can start on the communication."><meta itemprop=datePublished content="2022-01-11T20:15:51-05:00">
<meta itemprop=dateModified content="2022-01-11T20:15:51-05:00">
<meta itemprop=wordCount content="484">
<meta itemprop=keywords content>
<meta property="og:title" content="Raspberry Pi Zero Bringup">
<meta property="og:description" content="The Raspberry Pi Zero 2 is the main computer for the robot, and performs the path planning and high-level control for Opus. Although there is a previous post that outlines how to install CAN on a Pi Zero, it was determined that the CAN implementation would take much more time for insignificant returns. This post outlines how the initial setup was done on the Zero so that it is able to build programs for the Pico, program it, and development can start on the communication.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://uwopus.github.io/blog/posts/zero-bringup/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-01-11T20:15:51-05:00">
<meta property="article:modified_time" content="2022-01-11T20:15:51-05:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Raspberry Pi Zero Bringup">
<meta name=twitter:description content="The Raspberry Pi Zero 2 is the main computer for the robot, and performs the path planning and high-level control for Opus. Although there is a previous post that outlines how to install CAN on a Pi Zero, it was determined that the CAN implementation would take much more time for insignificant returns. This post outlines how the initial setup was done on the Zero so that it is able to build programs for the Pico, program it, and development can start on the communication.">
<link rel=canonical href=https://uwopus.github.io/blog/posts/zero-bringup/>
</head><body class="text-black duration-200 ease-out dark:text-white">
<header class="mx-auto flex h-[4.5rem] max-w-3xl px-8 lg:justify-center">
<div class="relative z-50 mr-auto flex items-center">
<a class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold" href=https://uwopus.github.io/blog/>Opus Build Blog: Autonomous Wall Plotting Robot</a>
<div class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]" role=button aria-label=Dark></div></div><div class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg="#faf8f1".replace(/"/g,''),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script>
<div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none">
</div></header><main class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl px-8 pb-16 pt-12 dark:prose-invert">
<article>
<header class=mb-16>
<h1 class="!my-0 pb-2.5">Raspberry Pi Zero Bringup</h1><div class="text-sm antialiased opacity-60">
<time>Jan 11, 2022</time>
</div></header><section><p>The Raspberry Pi Zero 2 is the main computer for the robot, and performs the path planning and high-level control for Opus. Although there is a previous post that outlines how to install CAN on a Pi Zero, it was determined that the CAN implementation would take much more time for insignificant returns. This post outlines how the initial setup was done on the Zero so that it is able to build programs for the Pico, program it, and development can start on the communication.</p><h2 id=systems-outline>Systems Outline</h2><p>The Zero 2 W is connected to a main board that provides power, an IMU connected over I2C and a port to communicate with the Raspberry Pi Pico board over SPI. This port also contains a SWD interface and power. This enables the Zero to program and debug the Pico.</p><h2 id=setup>Setup</h2><p>First, the <a href=https://www.raspberrypi.com/software/>Raspberry Pi Imager</a> tool was used to program Raspberry Pi Buster Lite onto an SD card. Advanced settings were used (accessible with ctrl+shift+x) to set the hostname to <code>Opus</code>, setup the Wi-Fi information and enable SSH on first boot. This allows the Pi to immediately be controlled wirelessly without having to purchase a microUSB to USB adapter to connect a keyboard and mouse.</p><p>Once booted, SPI and I2C were enabled with <code>sudo rpi-config</code>. The following steps were run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt upgrade
</span></span><span style=display:flex><span>sudo apt install git vim tmux gdb-multiarch
</span></span></code></pre></div><p>Next, the dependencies for programming the Pico were installed as per the Getting Started Guide.</p><p>We added this to the <code>~/.bashrc</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export PICO_SDK_PATH<span style=color:#f92672>=</span>/home/pi/pico/pico-sdk
</span></span></code></pre></div><p>OpenOCD was also installed with the following instructions from the Getting Started with Pico guide:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd ~/pico
</span></span><span style=display:flex><span>sudo apt install automake autoconf build-essential texinfo libtool libftdi-dev libusb-1.0-0-dev
</span></span><span style=display:flex><span>git clone https://github.com/raspberrypi/openocd.git --branch rp2040 --depth<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> --no-single-branch
</span></span><span style=display:flex><span>cd openocd
</span></span><span style=display:flex><span>./bootstrap
</span></span><span style=display:flex><span>./configure --enable-sysfsgpio --enable-bcm2835gpio
</span></span><span style=display:flex><span>make -j4
</span></span><span style=display:flex><span>sudo make install
</span></span></code></pre></div><blockquote>
<p>Note: The <code>./bootstrap</code> step might fail on platforms other than Raspbian because of some certificate errors. If this is the case, fix the certificates or manually download those repositories.</p></blockquote><p>An SSH key for accessing the <a href=https://www.github.com/uwopus>Opus Github Account</a> was installed.</p><p>VS Code remote access was installed and the C/C++ extension pack was installed along with Cortex Debug.</p><p>Finally, VS Code was tested on building and debugging the code, using these guides:</p><ul>
<li><a href=https://www.electronicshub.org/programming-raspberry-pi-pico-with-swd/>Programming Pi Pico with SWD</a></li><li><a href=https://blog.smittytone.net/2021/02/05/how-to-debug-a-raspberry-pi-pico-with-a-mac-swd/>How to Debug Your Project</a>
<ul>
<li>This one uses picoprobe, but we&rsquo;re bitbanging so the interface was changed to <code>/interface/raspberrypi-swd.cfg</code></li><li>The <code>gdbPath</code> was changed to <code>gdb-multiarch</code></li></ul></li></ul><p>The <code>launch.json</code> file looked like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;0.2.0&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;configurations&#34;</span>: [
</span></span><span style=display:flex><span>      { <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Pico Debug&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;device&#34;</span>: <span style=color:#e6db74>&#34;RP2040&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;gdbPath&#34;</span>: <span style=color:#e6db74>&#34;gdb-multiarch&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;cwd&#34;</span>: <span style=color:#e6db74>&#34;${workspaceRoot}&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;executable&#34;</span>: <span style=color:#e6db74>&#34;${command:cmake.launchTargetPath}&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;request&#34;</span>: <span style=color:#e6db74>&#34;launch&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;cortex-debug&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;servertype&#34;</span>: <span style=color:#e6db74>&#34;openocd&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;configFiles&#34;</span>: [
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;/interface/raspberrypi-swd.cfg&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;/target/rp2040.cfg&#34;</span>
</span></span><span style=display:flex><span>        ],
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;svdFile&#34;</span>: <span style=color:#e6db74>&#34;${env:PICO_SDK_PATH}/src/rp2040/hardware_regs/rp2040.svd&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;runToMain&#34;</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;postRestartCommands&#34;</span>: [
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;break main&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;continue&#34;</span>
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>   }
</span></span></code></pre></div><p>Debugging works, including breakpoints!</p><h2 id=image>Image</h2><p>An image of the SD card was taken with <code>dd</code>. It was attempted to reduce the partition size with <code>gparted</code> before this to reduce the image size, but it did not work.</p></section><nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
<a class="flex w-1/2 items-center rounded-l-md p-6 pr-3 font-semibold no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]" href=https://uwopus.github.io/blog/posts/picobringup/><span class=mr-1.5>←</span><span>Raspberry Pi Pico Bringup</span></a>
<a class="ml-auto flex w-1/2 items-center justify-end rounded-r-md p-6 pl-3 font-semibold no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]" href=https://uwopus.github.io/blog/posts/mech1/><span>3D Printing First Prototype</span><span class=ml-1.5>→</span></a>
</nav></article></main><footer class="opaco mx-auto flex h-[4.5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60">
<div class=mr-auto>
&copy; 2024
<a class=link href=https://uwopus.github.io/blog/>Opus Build Blog: Autonomous Wall Plotting Robot</a>
</div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>Powered by Hugo️️</a>️
<a class=link href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>✎ Paper</a>
</footer></body></html>