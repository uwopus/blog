<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Bringing up CAN on a Pi Zero 2 - Opus Build Blog</title><meta name=description content="The Problem Most guides online to enable CAN with SocketCAN on the Raspberry Pi, it is assumed that the MCP2515 is used. This chip is extremely popular, but because of the supply chain issues stemming from COVID-19, it is also very hard to find. When we ordered the components for Opus&rsquo;s main board, we were lucky enough to find some MCP 2510 chips in stock on Digikey. Since the Linux driver is called mcp251x, we assumed that it would be pretty easy to setup!"><meta name=author content><link rel="preload stylesheet" as=style href=https://uwopus.github.io/blog/app.min.css><link rel="preload stylesheet" as=style href=https://uwopus.github.io/blog/an-old-hope.min.css><script defer src=https://uwopus.github.io/blog/highlight.min.js onload=hljs.initHighlightingOnLoad()></script><link rel=preload as=image href=https://uwopus.github.io/blog/theme.png><link rel=icon href=https://uwopus.github.io/blog/favicon.ico><link rel=apple-touch-icon href=https://uwopus.github.io/blog/apple-touch-icon.png><meta name=generator content="Hugo 0.85.0"><meta property="og:title" content="Bringing up CAN on a Pi Zero 2"><meta property="og:description" content="The Problem Most guides online to enable CAN with SocketCAN on the Raspberry Pi, it is assumed that the MCP2515 is used. This chip is extremely popular, but because of the supply chain issues stemming from COVID-19, it is also very hard to find. When we ordered the components for Opus&rsquo;s main board, we were lucky enough to find some MCP 2510 chips in stock on Digikey. Since the Linux driver is called mcp251x, we assumed that it would be pretty easy to setup!"><meta property="og:type" content="article"><meta property="og:url" content="https://uwopus.github.io/blog/posts/can-bringup/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-17T22:15:51-05:00"><meta property="article:modified_time" content="2021-12-17T22:15:51-05:00"><meta itemprop=name content="Bringing up CAN on a Pi Zero 2"><meta itemprop=description content="The Problem Most guides online to enable CAN with SocketCAN on the Raspberry Pi, it is assumed that the MCP2515 is used. This chip is extremely popular, but because of the supply chain issues stemming from COVID-19, it is also very hard to find. When we ordered the components for Opus&rsquo;s main board, we were lucky enough to find some MCP 2510 chips in stock on Digikey. Since the Linux driver is called mcp251x, we assumed that it would be pretty easy to setup!"><meta itemprop=datePublished content="2021-12-17T22:15:51-05:00"><meta itemprop=dateModified content="2021-12-17T22:15:51-05:00"><meta itemprop=wordCount content="209"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Bringing up CAN on a Pi Zero 2"><meta name=twitter:description content="The Problem Most guides online to enable CAN with SocketCAN on the Raspberry Pi, it is assumed that the MCP2515 is used. This chip is extremely popular, but because of the supply chain issues stemming from COVID-19, it is also very hard to find. When we ordered the components for Opus&rsquo;s main board, we were lucky enough to find some MCP 2510 chips in stock on Digikey. Since the Linux driver is called mcp251x, we assumed that it would be pretty easy to setup!"></head><body class=not-ready data-menu=false><header class=header><p class=logo><a class=site-name href=https://uwopus.github.io/blog/>Opus Build Blog</a><a class=btn-dark></a></p><script>let bodyClx=document.body.classList,btnDark=document.querySelector('.btn-dark'),sysDark=window.matchMedia('(prefers-color-scheme: dark)'),darkVal=localStorage.getItem('dark'),setDark=a=>{bodyClx[a?'add':'remove']('dark'),localStorage.setItem('dark',a?'yes':'no')};setDark(darkVal?darkVal==='yes':sysDark.matches),requestAnimationFrame(()=>bodyClx.remove('not-ready')),btnDark.addEventListener('click',()=>setDark(!bodyClx.contains('dark'))),sysDark.addEventListener('change',a=>setDark(a.matches))</script></header><main class=main><article class=post-single><header class=post-title><p><time>:date_medium</time></p><h1>Bringing up CAN on a Pi Zero 2</h1></header><section class=post-content><h2 id=the-problem>The Problem</h2><p><a href=https://www.beyondlogic.org/adding-can-controller-area-network-to-the-raspberry-pi/>Most</a> <a href=https://www.hackster.io/youness/how-to-connect-raspberry-pi-to-can-bus-b60235>guides</a> online to enable CAN with SocketCAN on the Raspberry Pi, it is assumed that the MCP2515 is used. This chip is <em>extremely</em> popular, but because of the supply chain issues stemming from COVID-19, it is also very hard to find. When we ordered the components for Opus&rsquo;s main board, we were lucky enough to find some <a href=https://www.microchip.com/en-us/product/MCP2510>MCP 2510</a> chips in stock on Digikey. Since the Linux driver is called <code>mcp251x</code>, we assumed that it would be pretty easy to setup!</p><h2 id=solution-wip>Solution (WIP)</h2><p>Thought that just using the instructions from the aforementioned blog posts would work, just needed to change the <code>mcp2515</code> to <code>mcp2510</code>. This was really naive since the overlay just didn&rsquo;t exist. Figured out that you can decompile <code>.dtbo</code> files from <a href=https://stackoverflow.com/questions/21670967/how-to-compile-dts-linux-device-tree-source-files-to-dtb>this</a> post.</p><p>So, we used this process:</p><ol><li>Decompile the <code>/boot/overlays/mcp2515-can0.dtbo</code> file with <code>dtc -I dtb -O dts mcp2515-can0.dtbo > mcp2515-can0.dts</code></li><li>Make a copy of the dtc file called <code>mcp2510-can0.dts</code></li><li>Replace all mentions of <code>mcp2515</code> with <code>mcp2510</code> in that file.</li><li>Recompile this with <code>dtc -O dtb -o mcp2510-can0.dtbo mcp2510-can0.dts</code></li></ol><p>Put it in <code>/boot/overlays</code> and edit the <code>/boot/config.txt</code> file to have the following lines:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>dtoverlay<span style=color:#f92672>=</span>mcp2510-can0,oscillator<span style=color:#f92672>=</span>8000000,interrupt<span style=color:#f92672>=</span><span style=color:#ae81ff>19</span>
dtoverlay<span style=color:#f92672>=</span>spi0-hw-cs
</code></pre></div><p>Success-ish! Now, the logs show up in <code>dmesg</code> instead of nothing like before, but it still says <code>Wrong Wiring?</code></p></section><nav class=post-nav><a class=prev href=https://uwopus.github.io/blog/posts/zero-bringup/><span>←</span><span>Raspberry Pi Zero Bringup</span></a></nav></article></main><footer class=footer><p>&copy; 2022 <a href=https://uwopus.github.io/blog/>Opus Build Blog</a></p><p>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️</p><p><a href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Paper 5.1</a></p></footer></body></html>